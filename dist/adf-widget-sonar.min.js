!function(e,t){"use strict";function n(e,t){var n=this;t.max=e.maxDays,t.current=e.daysLeft,n.result=e,n.progressProperties=t}function o(e){var t=this;t.projectLeft=e.projectLeft,t.projectRight=e.projectRight}function r(e){for(var t=this,n=[],o=[],r=0;r<e.length;r++)n.push(e[r].metric),o.push(e[r].values);e.linesOfCode,e.technicalDebt,e.coverage,e.amountTest;t.series=n,t.labels=e[0].dates,t.values=o}function a(e,t){function n(t){var n=t.date,o=t.mode;if("day"===o)for(var r=new Date(n).setHours(0,0,0,0),a=0;a<e.events.length;a++){var s=new Date(e.events[a].date).setHours(0,0,0,0);if(r===s)return e.events[a].status}return""}e.today=function(){e.dt=new Date},e.today(),e.clear=function(){e.dt=null},e.inlineOptions={customClass:n,minDate:new Date,showWeeks:!0},e.dateOptions={formatYear:"yy",startingDay:1},e.toggleMin=function(){e.inlineOptions.minDate=e.inlineOptions.minDate?null:new Date,e.dateOptions.minDate=e.inlineOptions.minDate},e.toggleMin(),e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},e.setDate=function(t,n,o){e.dt=new Date(t,n,o)},e.formats=["yyyy-MM-dd","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.altInputFormats=["M!/d!/yyyy"],e.popup1={opened:!1},e.popup2={opened:!1};var o=new Date;o.setDate(o.getDate()+1);var r=new Date(o);r.setDate(o.getDate()+1),e.events=[{date:o,status:"full"},{date:r,status:"partially"}]}function s(e){var t=this;t.data=e}function i(e,t){function n(e){return e+"/api/resources?metrics=ncloc,coverage"}function o(e,t){return e+"/api/resources?resource="+t+"&metrics=open_issues,ncloc,public_documented_api_density,duplicated_lines_density,sqale_index"}function r(e,t){var n=new Date(e),o=new Date(t),r=new Date,s=a(n,o),i=a(r,o);console.log(o),console.log(r),console.log(n);var l={maxDays:s,daysLeft:i};return l}function a(e,t){if(e>t)return 0;var n=864e5;e.setHours(0,0,0,1),t.setHours(23,59,59,999);var o=t-e,r=Math.ceil(o/n),a=Math.floor(r/7);r-=2*a;var s=e.getDay(),i=t.getDay();return s-i>1&&(r-=2),0==s&&6!=i&&(r-=1),6==i&&0!=s&&(r-=1),r}function s(e){var t="";return e.linesOfCode&&(t+="ncloc,"),e.technicalDebt&&(t+="sqale_index,"),e.amountTest&&(t+="tests,"),e.testCoverage&&(t+="coverage,"),e.issues&&(t+="open_issues,"),e.rulesviolations&&(t+="duplicated_lines_density,"),t.slice(0,-1)}function i(n,r,a){var s=o(n,r),i=o(n,a),l=e.get(s),c=e.get(i),p=t.all([l,c]).then(function(e){var t=e[0].data[0].msr,n=e[1].data[0].msr,o={projectLeft:t,projectRight:n};return o});return p}function l(t,n,o,r,a,i){var l="",c=s(a);if(i){var p=new Date;i.week&&(o=new Date(p.getTime()-6048e5)),i.month&&(o=new Date(p.getFullYear(),p.getMonth()-1,p.getDay())),i.year&&(o=new Date(p.getFullYear()-1,p.getMonth(),p.getDay())),r=p}return l=o&&r?t+"/api/timemachine?resource="+n+"&metrics="+c+"&fromDateTime="+o+"&toDateTime="+r:t+"/api/timemachine?resource="+n+"&metrics="+c,e({method:"GET",url:l,headers:{Accept:"application/json"}}).then(function(e){for(var t=[],e=e.data[0],n=e.cols,o=e.cells,r=[],a=0;a<n.length;a++){for(var s=[],r=[],i=0;i<o.length;i++)r[i]=o[i].d.split("T")[0],s[i]=o[i].v[a];var l={metric:n[a].metric,values:s,dates:r};t.push(l)}return t})}function c(e){for(var t=0,n=0,o=0,r=0,a=0;a<e.length;a++)e[a].msr[0]&&(t=e[a].msr[0].val,n+=t),e[a].msr[1]&&(o=e[a].msr[1].val,r+=o);r/=e.length;var s={linesOfCode:n,coverage:r};return s}function p(t){var o=n(t);return e({method:"GET",url:o,headers:{Accept:"application/json"}}).then(function(e){var t=e.data,n=c(t);return n})}return{parseStuff:p,getChartData:l,getMetrics:i,getProjectTime:r}}var l=angular.module("adf.widget.sonar",["adf.provider","chart.js","ui.bootstrap","ui.bootstrap.datepicker","angular-svg-round-progressbar"]).constant("sonarEndpoint",{url:"https://nemo.sonarqube.org"}).config(["dashboardProvider",function(e){e.widget("sonar",{title:"All projects statistics",description:"widget to display sonar statistics",templateUrl:"{widgetsPath}/sonar/src/view.html",resolve:{data:["sonarApi","config","sonarEndpoint",function(e,t,n){return t.apiUrl?e.parseStuff(t.apiUrl):n.url?e.parseStuff(n.url):"Please Setup the Widget"}]},controller:"sonarStatsCtrl",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/sonar/src/edit.html"}}).widget("",{title:"project linechart",description:"widget to display a linechart with different metrics",templateUrl:"{widgetsPath}/sonar/src/chart/view.html",resolve:{data:["sonarApi","config","sonarEndpoint",function(e,t,n){return t.apiUrl?e.getChartData(t.apiUrl,t.project,t.fromDateTime,t.toDateTime,t.metrics,t.timespan):n.url&&t.project&&t.metrics?e.getChartData(n.url,t.project,t.fromDateTime,t.toDateTime,t.metrics,t.timespan):"Please Setup the Widget"}]},controller:"sonarLineChart",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/sonar/src/chart/edit.html"}}).widget("compare",{title:"project-compare",description:"widget to compare two projects",templateUrl:"{widgetsPath}/sonar/src/compare/view.html",resolve:{data:["sonarApi","config","sonarEndpoint",function(e,t,n){return t.apiUrl?e.getMetrics(t.apiUrl,t.projectname1,t.projectname2):n.url&&t.projectname1&&t.projectname2?e.getMetrics(n.url,t.projectname1,t.projectname2):"Please Setup the Widget"}]},controller:"compare",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/sonar/src/compare/edit.html"}}).widget("projectProgress",{title:"project-progress",description:"widget to check the project progress",templateUrl:"{widgetsPath}/sonar/src/project-progress/view.html",resolve:{data:["sonarApi","config","sonarEndpoint",function(e,t,n){return t.projectBeginn?e.getProjectTime(t.projectBeginn,t.projectEnd):"Please Setup the Widget"}]},controller:"progress",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/sonar/src/project-progress/edit.html"}})}]);angular.module("adf.widget.sonar").run(["$templateCache",function(e){e.put("{widgetsPath}/sonar/src/edit.html","<form role=form><div class=form-group><label for=sample>API-URL</label> <input type=text class=form-control id=sample ng-model=config.apiUrl placeholder=Sonar-URL></div></form>"),e.put("{widgetsPath}/sonar/src/view.html",'<style type=text/css>\n  .content {\n    text-align: right;\n    color: white;\n  }\n  .coverage {\n    background-color: #f0ad4e;\n    border-radius: 8px;\n  }\n  .linesOfCode {\n    background-color: #337ab7;\n    margin-bottom: 2%;\n    border-radius: 8px;\n  }\n  .linesOfCodePencil {\n    float: left;\n    font-size: 3em;\n    margin-top: 25px;\n  }\n  .coverageTask {\n    float: left;\n    font-size: 3em;\n    margin-top: 25px;\n  }\n</style><div><div class="content col-md-12"><div class="col-md-12 linesOfCode"><span class="glyphicon glyphicon-pencil linesOfCodePencil"></span><h1>{{(vm.data.linesOfCode | number)||0}}</h1><h4>Lines of code</h4></div><div class="col-md-12 coverage"><span class="glyphicon glyphicon-tasks coverageTask"></span><h1>{{(vm.data.coverage | number:2)||0}}%</h1><h4>Average test coverage</h4></div></div></div>'),e.put("{widgetsPath}/sonar/src/chart/edit.html",'<style type=text/css></style><form role=form><div class=form-group ng-controller=editController><label for=sample>API-URL</label><p><input class=form-control id=sample ng-model=config.apiUrl placeholder=Sonar-URL type=text></p><label for=sample>Projekt</label> (*Pflichtfeld)<p><input class=form-control id=sample ng-model=config.project ng-required=true placeholder=Projektbezeichnung type=text></p><label for=sample>Zeitspanne</label><p class=input-group><input class=form-control datepicker-options=dateOptions is-open=popup1.opened ng-model=config.fromDateTime placeholder=von show-button-bar=false type=text uib-datepicker-popup={{format}}> <span class=input-group-btn><button class="btn btn-default" ng-click=open1() type=button><i class="glyphicon glyphicon-calendar"></i></button></span></p><p class=input-group><input class=form-control datepicker-options=dateOptions is-open=popup2.opened ng-model=config.toDateTime placeholder=bis show-button-bar=false type=text uib-datepicker-popup={{format}}> <span class=input-group-btn><button class="btn btn-default" ng-click=open2() type=button><i class="glyphicon glyphicon-calendar"></i></button></span></p><p ng-init="config.timespan=null"><label class=radio-inline><input name=timespan ng-model=config.timespan.week type=radio value=1>letzte Woche</label> <label class=radio-inline><input name=timespan ng-model=config.timespan.month type=radio value=1>letzter Monat</label> <label class=radio-inline><input name=timespan ng-model=config.timespan.year type=radio value=1>letztes Jahr</label></p><label for=sample>Kennzahlen Auswahl</label><div class=checkbox><label><input ng-model=config.metrics.linesOfCode type=checkbox>Codezeilen</label></div><div class=checkbox><label><input ng-model=config.metrics.technicalDebt type=checkbox>Technische Schuld (min)</label></div><div class=checkbox><label><input ng-model=config.metrics.amountTest type=checkbox>Anzahl Unit-Tests</label></div><div class=checkbox><label><input ng-model=config.metrics.testCoverage type=checkbox>Test Abdeckung (%)</label></div><div class=checkbox><label><input ng-model=config.metrics.issues type=checkbox>Offene Issues</label></div><div class=checkbox><label><input ng-model=config.metrics.rulesviolations type=checkbox>Code Wiederholung (%)</label></div></div></form>'),e.put("{widgetsPath}/sonar/src/chart/view.html",'<style type=text/css></style><canvas id=line class="chart chart-line" chart-data=vm.values chart-labels=vm.labels chart-legend=true chart-series=vm.series></canvas>'),e.put("{widgetsPath}/sonar/src/compare/edit.html",'<form role=form><div class=form-group><label for=sample>API-URL</label> <input type=text class=form-control id=sample ng-model=config.apiUrl placeholder=Sonar-URL> <label for=sample>Projekt hinzufügen</label> <input type=text class=form-control id=sample ng-model=config.projectname1 ng-required=true placeholder="Projekt Links"> <label for=sample>Projekt hinzufügen</label> <input type=text class=form-control id=sample ng-model=config.projectname2 ng-required=true placeholder="Projekt Rechts"></div></form>'),e.put("{widgetsPath}/sonar/src/compare/view.html",'<style>\n  .border{\n    border: 2px solid black;\n    padding: 0px;\n  }\n  .metricText{\n    text-align: left;\n  }\n  .centerText{\n    text-align: center;\n  }\n  .tableHead{\n    background-color: #F5F5F5;\n  }\n</style><div class="col-md-12 centerText"><div class="col-md-4 border"><div class="border metricText tableHead"><h4>Metrik</h4></div><div ng-repeat="metric in vm.projectLeft"><div class=metricText>{{metric.key}}</div></div></div><div class="col-md-4 border"><div class="border tableHead"><h4>{{config.projectname1}}</h4></div><div class=table-responsive ng-repeat="projectLeft in vm.projectLeft"><div>{{projectLeft.frmt_val}}</div></div></div><div class="col-md-4 border"><div class="border tableHead"><h4>{{config.projectname2}}<h4></h4></h4></div><div class=table-responsive ng-repeat="projectRight in vm.projectRight"><div>{{projectRight.frmt_val}}</div></div></div></div>'),e.put("{widgetsPath}/sonar/src/project-progress/edit.html",'<form role=form><div class=form-group ng-controller=editController><label for=sample>Projekt</label> <input type=text class=form-control id=sample ng-model=config.projectname ng-required=true placeholder=Projektname> <label for=sample>Projekt Zeitraum</label><p class=input-group><input class=form-control datepicker-options=dateOptions is-open=popup1.opened ng-model=config.projectBeginn placeholder=von show-button-bar=false type=text uib-datepicker-popup={{format}}> <span class=input-group-btn><button class="btn btn-default" ng-click=open1() type=button><i class="glyphicon glyphicon-calendar"></i></button></span></p><p class=input-group><input class=form-control datepicker-options=dateOptions is-open=popup2.opened ng-model=config.projectEnd placeholder=bis show-button-bar=false type=text uib-datepicker-popup={{format}}> <span class=input-group-btn><button class="btn btn-default" ng-click=open2() type=button><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></form>'),e.put("{widgetsPath}/sonar/src/project-progress/view.html","<style>\n  .daysLeft{\n    text-align: center;\n\n  }\n  .info{\n    margin-top: -80%;\n    margin-bottom: 35%;\n  }\n</style><div class=daysLeft><div ng-init=\"progress=vm.progressProperties\"><round-progress max=progress.max current=progress.current color=\"{{ (current / max < 0.75) ? '#EF3939' : '#337AB7' }}\" bgcolor=#F5F5F5 radius=360 stroke=67 semi=false rounded=true clockwise=false responsive=true duration=800 animation=easeInOutQuart animation-delay=0></round-progress></div><div class=info><h1>{{config.projectname}}</h1><h1>{{vm.result.daysLeft}}/{{vm.result.maxDays}}</h1><p>Projekttage</p></div></div>")}]),l.controller("progress",n),n.$inject=["data","roundProgressConfig"],l.controller("compare",o),o.$inject=["data"],l.controller("sonarLineChart",r),r.$inject=["data"],l.controller("editController",a),a.$inject=["$scope","$http"],l.controller("sonarStatsCtrl",s),s.$inject=["data"],l.factory("sonarApi",i),i.$inject=["$http","$q"]}(window);